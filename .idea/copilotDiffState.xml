<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/store/slices/userSlice.ts">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/store/slices/userSlice.ts" />
              <option name="updatedContent" value="import { createSlice, createAsyncThunk, PayloadAction } from '@reduxjs/toolkit';&#10;import { getUser, login as loginService, register as registerService } from '../../services/user';&#10;&#10;export interface User {&#10;    id: string;&#10;    fullName: string;&#10;    email: string;&#10;    role: string;&#10;    profileImage?: string;&#10;}&#10;&#10;interface UserState {&#10;    user: User | null;&#10;    loading: boolean;&#10;    error: string | null;&#10;    isAuthenticated: boolean;&#10;}&#10;&#10;const initialState: UserState = {&#10;    user: null,&#10;    loading: false,&#10;    error: null,&#10;    isAuthenticated: false,&#10;};&#10;&#10;// Async thunks&#10;export const fetchUser = createAsyncThunk(&#10;    'user/fetchUser',&#10;    async (_, { rejectWithValue }) =&gt; {&#10;        try {&#10;            const accessToken = localStorage.getItem('accessToken');&#10;            if (!accessToken) {&#10;                throw new Error('No access token found');&#10;            }&#10;&#10;            const response = await getUser();&#10;            const userData = response.user || response;&#10;&#10;            const userObj: User = {&#10;                id: userData.id || userData._id,&#10;                fullName: userData.fullName || '',&#10;                email: userData.email || '',&#10;                role: userData.role || localStorage.getItem('role') || '',&#10;                profileImage: userData.profileImage || localStorage.getItem('profileImage') || undefined,&#10;            };&#10;&#10;            // Sync with localStorage&#10;            if (userObj.role) {&#10;                localStorage.setItem('role', userObj.role);&#10;            }&#10;            if (userObj.profileImage) {&#10;                localStorage.setItem('profileImage', userObj.profileImage);&#10;            }&#10;&#10;            return userObj;&#10;        } catch (error: any) {&#10;            return rejectWithValue(error.message || 'Failed to fetch user');&#10;        }&#10;    }&#10;);&#10;&#10;export const loginUser = createAsyncThunk(&#10;    'user/login',&#10;    async ({ email, password }: { email: string; password: string }, { rejectWithValue }) =&gt; {&#10;        try {&#10;            const data = await loginService(email, password);&#10;&#10;            // Save tokens &amp; role&#10;            localStorage.setItem('accessToken', data.accessToken);&#10;            localStorage.setItem('refreshToken', data.refreshToken);&#10;            localStorage.setItem('role', data.user.role);&#10;&#10;            // Save profile image if available&#10;            if (data.user.profileImage) {&#10;                localStorage.setItem('profileImage', data.user.profileImage);&#10;            }&#10;&#10;            const userObj: User = {&#10;                id: data.user.id || data.user._id,&#10;                fullName: data.user.fullName || '',&#10;                email: data.user.email || '',&#10;                role: data.user.role || '',&#10;                profileImage: data.user.profileImage || undefined,&#10;            };&#10;&#10;            return { user: userObj, role: data.user.role };&#10;        } catch (error: any) {&#10;            return rejectWithValue(error.message || 'Login failed');&#10;        }&#10;    }&#10;);&#10;&#10;export const registerUser = createAsyncThunk(&#10;    'user/register',&#10;    async ({ fullName, email, password }: { fullName: string; email: string; password: string }, { rejectWithValue }) =&gt; {&#10;        try {&#10;            const data = await registerService(fullName, email, password);&#10;            return data;&#10;        } catch (error: any) {&#10;            return rejectWithValue(error.message || 'Registration failed');&#10;        }&#10;    }&#10;);&#10;&#10;const userSlice = createSlice({&#10;    name: 'user',&#10;    initialState,&#10;    reducers: {&#10;        setUser: (state, action: PayloadAction&lt;User | null&gt;) =&gt; {&#10;            state.user = action.payload;&#10;            state.isAuthenticated = !!action.payload;&#10;        },&#10;        updateProfileImage: (state, action: PayloadAction&lt;string&gt;) =&gt; {&#10;            if (state.user) {&#10;                state.user.profileImage = action.payload;&#10;                localStorage.setItem('profileImage', action.payload);&#10;                window.dispatchEvent(new Event('profileImageUpdated'));&#10;            }&#10;        },&#10;        logout: (state) =&gt; {&#10;            state.user = null;&#10;            state.isAuthenticated = false;&#10;            state.error = null;&#10;            localStorage.removeItem('accessToken');&#10;            localStorage.removeItem('refreshToken');&#10;            localStorage.removeItem('role');&#10;            localStorage.removeItem('profileImage');&#10;        },&#10;        clearError: (state) =&gt; {&#10;            state.error = null;&#10;        },&#10;    },&#10;    extraReducers: (builder) =&gt; {&#10;        // Fetch user&#10;        builder&#10;            .addCase(fetchUser.pending, (state) =&gt; {&#10;                state.loading = true;&#10;                state.error = null;&#10;            })&#10;            .addCase(fetchUser.fulfilled, (state, action) =&gt; {&#10;                state.loading = false;&#10;                state.user = action.payload;&#10;                state.isAuthenticated = true;&#10;            })&#10;            .addCase(fetchUser.rejected, (state, action) =&gt; {&#10;                state.loading = false;&#10;                state.error = action.payload as string;&#10;                state.isAuthenticated = false;&#10;            });&#10;&#10;        // Login user&#10;        builder&#10;            .addCase(loginUser.pending, (state) =&gt; {&#10;                state.loading = true;&#10;                state.error = null;&#10;            })&#10;            .addCase(loginUser.fulfilled, (state, action) =&gt; {&#10;                state.loading = false;&#10;                state.user = action.payload.user;&#10;                state.isAuthenticated = true;&#10;            })&#10;            .addCase(loginUser.rejected, (state, action) =&gt; {&#10;                state.loading = false;&#10;                state.error = action.payload as string;&#10;                state.isAuthenticated = false;&#10;            });&#10;&#10;        // Register user&#10;        builder&#10;            .addCase(registerUser.pending, (state) =&gt; {&#10;                state.loading = true;&#10;                state.error = null;&#10;            })&#10;            .addCase(registerUser.fulfilled, (state) =&gt; {&#10;                state.loading = false;&#10;                state.error = null;&#10;            })&#10;            .addCase(registerUser.rejected, (state, action) =&gt; {&#10;                state.loading = false;&#10;                state.error = action.payload as string;&#10;            });&#10;    },&#10;});&#10;&#10;export const { setUser, updateProfileImage, logout, clearError } = userSlice.actions;&#10;export default userSlice.reducer;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>